<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BET300 Â· Slot Express</title>
<meta name="theme-color" content="#0a0f1f"/>
<style>
:root{
  --bg:#0a0f1f; --panel:#0f132b; --panel2:#0b1026; --border:#1a2250;
  --text:#e9ecff; --muted:#aab0d6; --ok:#25D366; --accent:#7c4dff; --cyan:#22d3ee; --gold:#ffd166;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto}
body::before{content:"";position:fixed;inset:0;z-index:-2;background:
  radial-gradient(900px 500px at 70% -10%, rgba(124,77,255,.25), transparent),
  radial-gradient(700px 350px at 0% 0%, rgba(0,209,255,.18), transparent),
  linear-gradient(180deg,#0a0f1f 0%,#0a0f1f 60%,#080c1a 100%);
}
.container{max-width:980px;margin:10px auto 100px;padding:0 12px}
.card{background:
  radial-gradient(120% 100% at 50% 0%, rgba(124,77,255,.09), transparent),
  var(--panel2);
  border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 15px 40px rgba(0,0,0,.35)}
@media(min-width:900px){.grid{display:grid;grid-template-columns:1.15fr .85fr;gap:14px}}
@media(max-width:520px){.card{border-radius:0;border-left:0;border-right:0}}
.head{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px}
.brand{font-weight:900;letter-spacing:.5px}
.pill{background:linear-gradient(90deg,rgba(124,77,255,.13),rgba(0,209,255,.13));border:1px solid var(--border);
  border-radius:999px;padding:6px 10px;font-size:12px;color:var(--muted)}
.pill.time{display:flex;gap:8px;align-items:center}
.pill.sound{cursor:pointer;user-select:none}
.count{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;background:rgba(255,204,0,.15);
  border:1px solid rgba(255,204,0,.35);color:#ffe27a;font-weight:700;font-variant-numeric:tabular-nums}
h1,h2,h3,p{margin:0 0 8px}
h1{font-size:22px}
.muted{color:var(--muted)}
.rightTop{margin-left:auto;display:flex;gap:8px;align-items:center}
.btnLink{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border-radius:12px;font-weight:800;
  background:linear-gradient(90deg,#7c59ff,#00d1ff);color:#0a0f1f;text-decoration:none;border:1px solid rgba(255,255,255,.06)}
.btnLink .icon{filter:drop-shadow(0 2px 8px rgba(0,0,0,.35))}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:14px}
.center{text-align:center}
.stat{display:flex;gap:12px;align-items:center;justify-content:center;margin:8px 0 12px}
.badge{min-width:72px;height:46px;border-radius:12px;background:radial-gradient(100% 100% at 50% 0%, rgba(0,209,255,.35), rgba(124,77,255,.35));
  display:grid;place-items:center;font-weight:800;font-size:18px;box-shadow:inset 0 0 10px rgba(124,77,255,.35)}
.smallline{font-size:12px;color:var(--muted)}
.stage{display:flex;justify-content:center}
.slotWrap{width:100%;max-width:520px;margin:8px auto 0}
.slot{position:relative;border-radius:18px;padding:12px;background:
  linear-gradient(180deg,rgba(124,77,255,.18),rgba(34,211,238,.18));
  border:1px solid var(--border);box-shadow:inset 0 0 0 1px rgba(255,255,255,.03), 0 10px 30px rgba(0,0,0,.35)}
.reelFrame{position:relative;border-radius:14px;padding:10px;background:rgba(10,15,35,.65);
  border:1px solid #2a2f58}
.reels{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.reel{background:#0c1230;border-radius:12px;padding:10px;border:1px solid #30376a}
canvas{width:100%;height:140px;display:block;border-radius:10px;background:linear-gradient(180deg,#0d1438,#0a102c)}
@media(min-width:480px){canvas{height:160px}}
.shadowTop,.shadowBot{position:absolute;left:0;right:0;height:28px;pointer-events:none}
.shadowTop{top:0;background:linear-gradient(180deg,rgba(10,15,35,.75),transparent)}
.shadowBot{bottom:0;background:linear-gradient(0deg,rgba(10,15,35,.75),transparent)}
.hint{text-align:center;color:var(--muted);font-size:13px;margin-top:6px}

.dock{position:fixed;left:0;right:0;bottom:0;z-index:20;background:linear-gradient(180deg, rgba(11,15,30,0) 0%, rgba(11,15,30,.85) 22%, rgba(11,15,30,.95) 100%);
  padding:10px 12px 12px;display:flex;gap:10px}
.btn{appearance:none;border:none;cursor:pointer;padding:14px 16px;border-radius:14px;font-weight:800;background:linear-gradient(90deg,#ff9a3d,#ff5c39);color:#0b0f1e;width:100%;
  box-shadow:0 8px 20px rgba(0,0,0,.35)}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn.ok{background:#25D366;color:#0b0f1e}
.badgeWin{display:inline-block;padding:6px 10px;border-radius:10px;background:rgba(255,209,102,.15);color:var(--gold);border:1px solid rgba(255,209,102,.35);font-weight:800}

.confetti{position:fixed;inset:0;pointer-events:none;z-index:40}
.confetti i{position:absolute;top:-20px;width:10px;height:14px;border-radius:2px;opacity:0;animation:confFall 1.6s linear forwards}
@keyframes confFall{8%{opacity:1}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
</style>
</head>
<body>
<div id="confetti" class="confetti" aria-hidden="true"></div>

<div class="container">
  <div class="card">
    <div class="head">
      <div class="brand">BET300</div>
      <span class="pill">Promo interactiva</span>
      <span class="pill time">âš¡ Tiempo limitado <span class="count" id="countdown">--:--</span></span>
      <span class="pill sound" id="soundToggle">ðŸ”Š Sonido: <b id="soundState">ON</b></span>
      <div class="rightTop">
        <a id="playNow" class="btnLink" target="_blank" rel="noopener">
          <span class="icon">ðŸŽ®</span><span>Entrar a la plataforma</span>
        </a>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h1>Slot Express Â· 3 rodillos</h1>
        <p class="muted">HacÃ© girar y descubrÃ­ tu premio. Con <b>3 iguales</b> accedÃ©s al <span class="badgeWin">premio mayor</span>. Con <b>2 iguales</b>, premio medio. Si no, <b>premio garantizado</b>.</p>
        <div class="stage">
          <div class="slotWrap slot">
            <div class="shadowTop"></div>
            <div class="reelFrame">
              <div class="reels">
                <div class="reel"><canvas id="r1" width="240" height="320"></canvas></div>
                <div class="reel"><canvas id="r2" width="240" height="320"></canvas></div>
                <div class="reel"><canvas id="r3" width="240" height="320"></canvas></div>
              </div>
            </div>
            <div class="shadowBot"></div>
            <div class="hint">Tip: mejor visual en vertical ðŸ“±</div>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="center">
          <div class="stat">
            <div>
              <div class="badge" id="badge">-</div>
              <div class="smallline" id="stampLine" aria-live="polite"></div>
            </div>
            <div>
              <h2 id="title">TenÃ©s 1 giro disponible</h2>
              <p class="muted" id="subtitle">Los premios se acreditan con tu <b>prÃ³xima carga mÃ­nima</b>.</p>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:8px">
          <p style="margin-bottom:6px"><b>Resultado actual</b></p>
          <p id="resultLine" class="muted">â€”</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dock">
  <button id="spinBtn" class="btn">ðŸŽ¯ Girar</button>
  <button id="claimBtn" class="btn ok" disabled>ðŸ“² Reclamar</button>
</div>

<script>
/* ===== Config general ===== */
const PLATFORM_LINK = "https://alvg.bet300vip.com";
document.getElementById('playNow').href = PLATFORM_LINK;

/* WhatsApp por PC (Argentina +549) */
const WP_NUMBERS = {
  pc1: "5491131583516",
  pc2: "5491126695257",
  pc3: "5491125368306",
  pc4: "5491150030414"
};
const params = new URLSearchParams(location.search);
const pc = (params.get('pc')||"1").trim();
const WP = WP_NUMBERS["pc"+(pc.match(/^[1-4]$/)?pc:"1")];

/* Premio mayor / medio / base */
const HIGH_PRIZES = [
  {type:'money', value:5000},
  {type:'money', value:4000},
  {type:'percent', value:20},
  {type:'percent', value:15}
];
const MID_PRIZES = [
  {type:'money', value:3000},
  {type:'percent', value:12}
];
const BASE_PRIZES = [
  {type:'money', value:2000},
  {type:'money', value:1000},
  {type:'percent', value:10}
];

/* ===== Antifraude (device + cÃ³digo + timestamp) ===== */
const SALT = "bet300-slot-v1";
function ensureDeviceId(){
  let id = localStorage.getItem('device_id');
  if(!id){ id = (crypto.randomUUID?.() || `${Date.now()}-${Math.random().toString(36).slice(2,8)}`); localStorage.setItem('device_id', id); }
  return id;
}
const DEVICE_ID = ensureDeviceId();
function todayKey(){const n=new Date();return `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`}
function tsString(d=new Date()){
  const dd=String(d.getDate()).padStart(2,'0'),mm=String(d.getMonth()+1).padStart(2,'0'),yyyy=d.getFullYear();
  const hh=String(d.getHours()).padStart(2,'0'),mi=String(d.getMinutes()).padStart(2,'0');
  return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
}
async function sha256hex(msg){
  const enc = new TextEncoder().encode(msg);
  const buf = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function makeClaimCode(prizeLabel){
  const base = `${DEVICE_ID}|${todayKey()}|${prizeLabel}|pc:${pc}|${SALT}`;
  const hex = await sha256hex(base);
  return hex.slice(0,10).toUpperCase();
}

/* ===== Sonido ===== */
let soundOn = true;
const soundToggle = document.getElementById('soundToggle');
const soundState  = document.getElementById('soundState');
const AudioKit = (()=>{
  const Ctx = window.AudioContext || window.webkitAudioContext;
  const ctx = new Ctx(); let unlocked=false;
  function unlock(){ if(!unlocked){ ctx.resume().catch(()=>{}); unlocked=true; } }
  function click(freq=880,dur=0.04,vol=0.06){
    const o=ctx.createOscillator(), g=ctx.createGain(); o.type='square'; o.frequency.value=freq; g.gain.value=0; o.connect(g).connect(ctx.destination);
    const t=ctx.currentTime; g.gain.linearRampToValueAtTime(vol, t+0.005); g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
    o.start(t); o.stop(t+dur);
  }
  function spinLoop(){ const id=setInterval(()=>click(760+Math.random()*160,0.03,0.05),100); return ()=>clearInterval(id); }
  function win(){ [660,880,1320].forEach((f,i)=>setTimeout(()=>click(f,0.12,0.09), i*140)); }
  return {ctx,unlock,spinLoop,win};
})();
soundToggle.addEventListener('click',()=>{ soundOn=!soundOn; soundState.textContent=soundOn?'ON':'OFF';});

/* ===== Reels (canvas) ===== */
const SYMBOLS = ["ðŸ’Ž","7","ðŸ’","ðŸ””","â­"]; // sin imÃ¡genes
const COLS = [document.getElementById('r1'),document.getElementById('r2'),document.getElementById('r3')].map(c=>c.getContext('2d'));
const W = ()=>COLS[0].canvas.width, H = ()=>COLS[0].canvas.height;
let reelY = [0,0,0], spinning=false;

function drawReel(ctx, y){
  const w=ctx.canvas.width, h=ctx.canvas.height;
  ctx.clearRect(0,0,w,h);
  const cell = h/3;
  ctx.textAlign="center"; ctx.textBaseline="middle";
  for(let i=-1;i<5;i++){
    const sym = SYMBOLS[(i+Math.floor(y)) % SYMBOLS.length];
    const yy = (i - (y%1))*cell + h/2;
    // tarjeta
    const r=10, pad=8;
    ctx.fillStyle="#11183f"; ctx.strokeStyle="#2d356b"; ctx.lineWidth=2;
    roundRect(ctx, pad, yy-cell/2+6, w-pad*2, cell-12, r, true, true);
    // brillo
    const grad=ctx.createLinearGradient(0,yy-cell/2,0,yy+cell/2);
    grad.addColorStop(0,"rgba(124,77,255,.25)"); grad.addColorStop(1,"rgba(34,211,238,.25)");
    roundRect(ctx, pad+2, yy-cell/2+8, w-(pad+2)*2, cell-16, r-2, true, false, grad);

    ctx.font = `${Math.floor(cell*0.5)}px system-ui,Apple Color Emoji,Segoe UI Emoji`;
    ctx.fillStyle = "#e9ecff";
    ctx.fillText(sym, w/2, yy);
  }
}
function roundRect(ctx,x,y,w,h,r,fill=true,stroke=true,fillStyle){
  let rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr,y);
  ctx.arcTo(x+w,y,x+w,y+h,rr);
  ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr);
  ctx.arcTo(x,y,x+w,y,rr);
  if(fill){ ctx.fillStyle = fillStyle || ctx.fillStyle; ctx.fill(); }
  if(stroke){ ctx.stroke(); }
}
function renderAll(){ for(let i=0;i<3;i++) drawReel(COLS[i], reelY[i]); requestAnimationFrame(renderAll); }
renderAll();

/* ===== Juego ===== */
const spinBtn = document.getElementById('spinBtn');
const claimBtn= document.getElementById('claimBtn');
const badge   = document.getElementById('badge');
const title   = document.getElementById('title');
const subtitle= document.getElementById('subtitle');
const resultLine = document.getElementById('resultLine');
const stampEl = document.getElementById('stampLine');

let stopLoop=null;

function pickOutcome(){
  // Probabilidades simples: 3 iguales ~10%, 2 iguales ~35%, resto base.
  const r = Math.random();
  if(r<0.10){
    const s = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
    return [s,s,s];
  }else if(r<0.45){
    const s = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
    const t = SYMBOLS.filter(x=>x!==s)[Math.floor(Math.random()*(SYMBOLS.length-1))];
    const pos = Math.floor(Math.random()*3);
    const arr = [t,t,t]; arr[pos]=s; return arr;
  }else{
    let a=SYMBOLS[0],b=SYMBOLS[1],c=SYMBOLS[2];
    while(a===b) b = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
    while(c===a || c===b) c = SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
    return [a,b,c];
  }
}

function symbolIndex(sym){ return SYMBOLS.indexOf(sym); }

function whatsappText(prizeLabel){
  const code = localStorage.getItem('slot_code') || '(SIN-COD)';
  const ts   = localStorage.getItem('slot_ts')   || tsString();
  return `Hola, ganÃ© ${prizeLabel} en el Slot BET300 y quiero reclamarlo con mi prÃ³xima carga. CÃ³digo: ${code} Â· ${ts}`;
}

function money(n){ return "$"+n.toLocaleString("es-AR"); }
function label(p){ return p.type==='money' ? money(p.value) : `${p.value}%`; }
function subtitleHTML(p){ return p.type==='money'
  ? `RecibÃ­s <b>${money(p.value)} extra</b> con tu prÃ³xima carga.`
  : `RecibÃ­s un <b>${p.value}% extra</b> con tu prÃ³xima carga.`; }

function choosePrize(outcome){
  const [a,b,c]=outcome;
  if(a===b && b===c) return HIGH_PRIZES[Math.floor(Math.random()*HIGH_PRIZES.length)];
  if(a===b || a===c || b===c) return MID_PRIZES[Math.floor(Math.random()*MID_PRIZES.length)];
  return BASE_PRIZES[Math.floor(Math.random()*BASE_PRIZES.length)];
}

function confettiBurst(){
  const el=document.getElementById('confetti'); el.innerHTML='';
  const n=28;
  for(let i=0;i<n;i++){
    const p=document.createElement('i');
    p.style.left=(Math.random()*100)+'vw';
    p.style.animationDelay=(Math.random()*0.5)+'s';
    p.style.background = Math.random()<.5?'linear-gradient(#80ffea,#4e9cff)':'linear-gradient(#ffd166,#ff3d7f)';
    el.appendChild(p);
  }
  setTimeout(()=>{el.innerHTML='';},1800);
}

/* Persistencia diaria */
function restoreDaily(){
  const today=todayKey(); const stored=localStorage.getItem('slot_date');
  if(stored && stored!==today){
    localStorage.removeItem('slot_done');
    localStorage.removeItem('slot_prize');
    localStorage.removeItem('slot_code');
    localStorage.removeItem('slot_ts');
    localStorage.setItem('slot_date',today);
  }else if(!stored){ localStorage.setItem('slot_date',today); }
}
function restorePrizeIfAny(){
  const done=localStorage.getItem('slot_done')==='1'; const saved=localStorage.getItem('slot_prize');
  if(done && saved){
    const p=JSON.parse(saved);
    const code = localStorage.getItem('slot_code') || 'â€”';
    const ts   = localStorage.getItem('slot_ts')   || tsString();
    badge.textContent=label(p); title.textContent="ðŸŽ‰ Â¡Premio obtenido!";
    subtitle.innerHTML=subtitleHTML(p);
    stampEl.textContent=`CÃ³digo: ${code} Â· ${ts}`;
    claimBtn.disabled=false; spinBtn.disabled=true;
    const msg=whatsappText(label(p));
    claimBtn.onclick=()=>location.href=`https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;
  }
}
function scheduleMidnightReset(){
  const now=new Date(); const midnight=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,5,0);
  setTimeout(()=>{localStorage.removeItem('slot_done');localStorage.removeItem('slot_prize');localStorage.removeItem('slot_code');localStorage.removeItem('slot_ts');localStorage.setItem('slot_date',todayKey());
    spinBtn.disabled=false; badge.textContent='-'; title.textContent='TenÃ©s 1 giro disponible';
    subtitle.innerHTML='Los premios se acreditan con tu <b>prÃ³xima carga mÃ­nima</b>.'; stampEl.textContent=''; resultLine.textContent='â€”';
  }, midnight.getTime()-now.getTime());
}
function endOfDay(){const n=new Date();const end=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,0,0).getTime();
  return end>Date.now()?end:new Date(n.getFullYear(),n.getMonth(),n.getDate()+1,23,59,0,0).getTime()}
function tickCountdown(){
  const ms=endOfDay()-Date.now(); const total=Math.max(0,Math.floor(ms/1000));
  const h=Math.floor(total/3600), m=Math.floor((total%3600)/60), s=total%60;
  document.getElementById('countdown').textContent=h>0?`${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`:`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

/* Spin */
document.addEventListener('click',()=>AudioKit.unlock(),{once:true});

spinBtn.addEventListener('click', async ()=>{
  if(spinning) return;
  if(localStorage.getItem('slot_done')==='1'){ alert("Ya usaste tu giro de hoy"); return; }

  spinning=true; spinBtn.disabled=true;
  if(soundOn) stopLoop = AudioKit.spinLoop();

  const outcome = pickOutcome(); // sÃ­mbolos finales
  const indexes = outcome.map(symbolIndex);

  // calculamos vueltas extra + offset para caer en el Ã­ndice deseado
  const base = [5,6,7]; // vueltas base
  const targetY = [0,0,0].map((_,i)=> base[i] + indexes[i] + Math.random()*0.2);

  const start = performance.now();
  const dur = [1700,2200,2700]; // escalonado por reel

  (function anim(t){
    let done=0;
    for(let i=0;i<3;i++){
      const k = Math.min(1,(t-start)/dur[i]);
      const ease = 1-Math.pow(1-k,3);
      reelY[i] = ease*targetY[i];
      if(k>=1) done++;
    }
    if(done<3){ requestAnimationFrame(anim); }
    else { onStop(outcome); }
  })(start);
});

async function onStop(outcome){
  if(soundOn && stopLoop) { stopLoop(); stopLoop=null; }
  const prize = choosePrize(outcome);
  const prizeLabel = label(prize);

  const code = await makeClaimCode(prizeLabel);
  const ts   = tsString(new Date());
  localStorage.setItem('slot_code', code);
  localStorage.setItem('slot_ts', ts);
  localStorage.setItem('slot_prize', JSON.stringify(prize));
  localStorage.setItem('slot_done', '1');

  badge.textContent = prizeLabel;
  title.textContent = "ðŸŽ‰ Â¡Premio obtenido!";
  subtitle.innerHTML= subtitleHTML(prize);
  stampEl.textContent = `CÃ³digo: ${code} Â· ${ts}`;
  resultLine.textContent = `Rodillos: ${outcome.join(" | ")}`;

  const msg = whatsappText(prizeLabel);
  claimBtn.disabled=false;
  claimBtn.onclick=()=>location.href=`https://wa.me/${WP}?text=${encodeURIComponent(msg)}`;

  if(soundOn) AudioKit.win();
  confettiBurst();
  spinning=false;
}

/* Init */
function init(){
  restoreDaily(); restorePrizeIfAny(); tickCountdown();
  setInterval(tickCountdown,1000); scheduleMidnightReset();
  // dibujar algo inicial
  reelY=[0,0,0];
}
init();
</script>
</body>
</html>
